function debug(e){console.log("better-learn:",e)}const GET_VIDEO_LESSON_QUERY="query GetVideoLesson($uniqueCode: String!, $subsectionUniqueCode: String!, $moduleUniqueCode: String!, $inVideoQuestionFilter: InVideoQuestionFilter, $inVideoQuestionOrder: [InVideoQuestionOrdering]) {  videoLesson(    filter: {uniqueCode: $uniqueCode, subsectionUniqueCode: $subsectionUniqueCode, moduleUniqueCode: $moduleUniqueCode}  ) {    id    module {      id      uniqueCode      title      examBoardSubject {        subject: subjectObject {          qualification {            uniqueCode            __typename          }          __typename        }        __typename      }      __typename    }    subsection {      id      name      uniqueCode      __typename    }    wistiaId    uniqueCode    title    length    duration    extraContent    skipRecapStartTime    preVideoQuestions {      __typename      id      quizContent {        ...UnmarkedQuestion        __typename      }    }    inVideoQuizQuestions(      filter: $inVideoQuestionFilter      order: $inVideoQuestionOrder    ) {      __typename      id      triggerTime      postQuestionResumeTime      quizContent {        __typename        ...UnmarkedQuestion      }    }    __typename  }}fragment UnmarkedQuestion on QuizContent {  __typename  id  stem  quizDefinition {    __typename    questions {      ...UnmarkedQuestionPart      __typename    }  }}fragment UnmarkedQuestionPart on QuizQuestion {  __typename  ... on MultipleChoiceQuestion {    question    description    image    topImage    options {      text      image      __typename    }    __typename  }  ... on MultiMultipleChoiceQuestion {    question    description    image    topImage    options {      text      image      __typename    }    __typename  }  ... on TextQuestion {    question    description    image    topImage    beforeText    afterText    __typename  }  ... on NumericalQuestion {    question    description    image    topImage    beforeText    afterText    __typename  }  ... on MathsQuestion {    question    description    image    topImage    __typename  }  ... on MultipleInputQuestion {    questionSegments {      type: __typename      ... on MultipleInputQuestionText {        text        __typename      }      ... on MultipleInputQuestionBlank {        fieldIndex        __typename      }    }    description    image    topImage    __typename  }  ... on ChemistryQuestion {    question    description    image    topImage    __typename  }  ... on DropdownQuestion {    question    description    image    topImage    dropdownOptions    __typename  }  ... on DrawQuestion {    question    description    image    topImage    drawOn    __typename  }  ... on EngageQuestion {    question    description    image    topImage    __typename  }}";async function apiFetch(e,t){debug("apiFetch"),debug({body:t});let n=await fetch("https://web.uplearn.co.uk/api/",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},credentials:"include",body:JSON.stringify(t)});return n=await n.json(),debug({response:n}),n}function getCookie(e){const t=document.cookie.match(new RegExp("(^|;\\s*)"+e+"=([^;]*)"));return t?decodeURIComponent(t[2]):null}async function getAuth(){return debug("getAuth"),getCookie("auth-token")}function setVideoSpeed(e){debug(`setVideoSpeed ${e}`),document.querySelector("video").playbackRate=e}function sleep(e){return new Promise((t=>setTimeout(t,e)))}async function waitForQuestion(){for(;;){const e=document.querySelector("media-controller"),{display:t}=window.getComputedStyle(e,null);if("none"!==t)break;await sleep(500)}}function skipToQuestion(e){debug(`skipping to ${e} seconds`),document.querySelector("video").currentTime=e}function durationToSeconds(e){const t=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+(?:\.\d+)?)S)?/);if(!t)return 0;return 3600*parseFloat(t[1]||0)+60*parseFloat(t[2]||0)+parseFloat(t[3]||0)}async function skipVideoLesson(){debug("skipVideoLesson");const e=window.location.href;setVideoSpeed(0),skipToQuestion(0);const t=new URL(e).pathname.split("/").filter(Boolean),[n,i,o]=t.slice(-3);if(debug({moduleUniqueCode:n,subsectionUniqueCode:i,videoUniqueCode:o}),"video"!=o.slice(-5))return;const u={operationName:"GetVideoLesson",variables:{moduleUniqueCode:n,subsectionUniqueCode:i,uniqueCode:o,inVideoQuestionOrder:[{field:"TRIGGER_TIME",direction:"ASC"}]},query:GET_VIDEO_LESSON_QUERY},s=await getAuth(),a=await apiFetch(s,u),d=a.data.videoLesson.inVideoQuizQuestions,r=durationToSeconds(a.data.videoLesson.duration);for(const e of d)timestamp=durationToSeconds(e.triggerTime),skipToQuestion(timestamp),await sleep(2e3),await waitForQuestion();skipToQuestion(r),setVideoSpeed(1)}skipVideoLesson();
